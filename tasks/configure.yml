# This source file is subject to the (Open Source Initiative) BSD license
# that is bundled with this package in the LICENSE file. It is also available
# through the world-wide-web at this URL: http://www.ontic.com.au/license.html
# If you did not receive a copy of the license and are unable to obtain it through
# the world-wide-web, please send an email to license@ontic.com.au immediately.
# Copyright (c) 2010-2016 Ontic. (http://www.ontic.com.au). All rights reserved.

---

- name: 'NFS | Configure exports directories.'
  become: yes
  file:
    path: '{{ item.path }}'
    state: 'directory'
    owner: '{{ item.owner | default(omit) }}'
    group: '{{ item.group | default(omit) }}'
    mode: '{{ item.mode | default("0755") }}'
  notify: 'restart nfs'
  with_items: '{{ nfs_exports }}'
  when: '{{ nfs_exports | default(None) != None }}'

- name: 'NFS | Configure exports file.'
  become: yes
  template:
    src: '{{ nfs_exports_template }}'
    dest: '/etc/exports'
    owner: 'root'
    group: 'root'
    mode: '0644'
  notify: 'restart nfs'

- name: 'NFS | Configure mounts.'
  become: yes
  mount:
    name: '{{ item.name }}'
    dump: '{{ item.dump | default(omit) }}'
    fstab: '{{ item.fstab | default(omit) }}'
    fstype: '{{ item.fstab | default(omit) }}'
    opts: '{{ item.opts | default(omit) }}'
    passno: '{{ item.passno | default(omit) }}'
    src: '{{ item.src | default(omit) }}'
    state: '{{ item.state | default("mounted") }}'
  with_items: '{{ nfs_mounts }}'
  when: '{{ nfs_mounts | default(None) != None }}'